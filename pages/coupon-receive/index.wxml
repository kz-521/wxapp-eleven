<view class="page">
  <!-- 加载状态 -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <view class="loading-text">正在获取优惠券信息...</view>
  </view>

  <!-- 优惠券详情 -->
  <view class="coupon-container" wx:elif="{{couponDetail && !showSuccess}}">
    <!-- 优惠券卡片 -->
    <view class="coupon-card">
      <view class="coupon-left">
        <view class="coupon-value">
          <text class="value-symbol" wx:if="{{couponDetail.type === 1}}">¥</text>
          <text class="value-number" wx:if="{{couponDetail.type === 1}}">{{couponDetail.minus}}</text>
          <text class="value-number" wx:elif="{{couponDetail.type === 2}}">{{couponDetail.discount}}</text>
          <text class="value-unit" wx:elif="{{couponDetail.type === 2}}">折</text>
        </view>
        <view class="coupon-type">{{couponDetail.type_text}}</view>
      </view>
      
      <view class="coupon-right">
        <view class="coupon-title">{{couponDetail.title}}</view>
        <view class="coupon-condition" wx:if="{{couponDetail.full_money}}">
          满{{couponDetail.full_money}}元可用
        </view>
        <view class="coupon-condition" wx:else>
          无门槛使用
        </view>
        <view class="coupon-time">
          有效期：{{couponDetail.start_time}} 至 {{couponDetail.end_time}}
        </view>
        <view class="coupon-desc" wx:if="{{couponDetail.description}}">
          {{couponDetail.description}}
        </view>
      </view>
    </view>

    <!-- 优惠券说明 -->
    <view class="coupon-rules">
      <view class="rules-title">使用说明</view>
      <view class="rules-item">• 本优惠券仅限清汀使用</view>
      <view class="rules-item">• 不可与其他优惠活动同时使用</view>
      <view class="rules-item">• 优惠券一经使用不可退回</view>
      <view class="rules-item">• 超过有效期自动失效</view>
    </view>

    <!-- 领取按钮 -->
    <view class="receive-button-container">
      <button class="receive-button {{receiving ? 'loading' : ''}}" 
              bindtap="receiveCoupon" 
              disabled="{{receiving}}">
        <text wx:if="{{!receiving}}">立即领取</text>
        <text wx:else>领取中...</text>
      </button>
    </view>
  </view>

  <!-- 领取成功状态 -->
  <view class="success-container" wx:elif="{{showSuccess}}">
    <view class="success-icon">✓</view>
    <view class="success-title">恭喜您！</view>
    <view class="success-desc">优惠券领取成功</view>
    
    <!-- 成功后显示的优惠券 -->
    <view class="success-coupon" wx:if="{{receivedCoupon}}">
      <view class="coupon-card small">
        <view class="coupon-left">
          <view class="coupon-value">
            <text class="value-symbol" wx:if="{{receivedCoupon.type === 1}}">¥</text>
            <text class="value-number" wx:if="{{receivedCoupon.type === 1}}">{{receivedCoupon.minus}}</text>
            <text class="value-number" wx:elif="{{receivedCoupon.type === 2}}">{{receivedCoupon.discount}}</text>
            <text class="value-unit" wx:elif="{{receivedCoupon.type === 2}}">折</text>
          </view>
          <view class="coupon-type">{{receivedCoupon.type_text}}</view>
        </view>
        
        <view class="coupon-right">
          <view class="coupon-title">{{receivedCoupon.title}}</view>
          <view class="coupon-time">
            有效期至：{{receivedCoupon.end_time}}
          </view>
        </view>
      </view>
    </view>

    <!-- 操作按钮 -->
    <view class="success-actions">
      <button class="action-button secondary" bindtap="goMyCoupons">
        查看我的优惠券
      </button>
      <button class="action-button primary" bindtap="goHome">
        去购物
      </button>
    </view>
  </view>
</view>